<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>SCAMP-5c Vision System: SPI Macros</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doc_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="scamp5c_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SCAMP-5c Vision System
   &#160;<span id="projectnumber">1.0.0</span>
   </div>
   <div id="projectbrief">An image sensor with a parallel processor on focal plane</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#files">Files</a>  </div>
  <div class="headertitle">
<div class="title">SPI Macros</div>  </div>
</div><!--header-->
<div class="contents">

<p>these macros typically provide the SPI communication functionalities  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="files"></a>
Files</h2></td></tr>
<tr class="memitem:a00031"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00031.html">spi_macros.h</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>these macros typically provide the SPI communication functionalities </p>
<h1><a class="anchor" id="s5c_spi_macro_sec_1"></a>
Introduction</h1>
<p>SCAMP-5c has a SPI interface and can work as a SPI slave, which is used to communicate with Odroid XU4. The SPI bus is configured to be working at 2.5 Mhz.</p>
<h1><a class="anchor" id="s5c_spi_macro_sec_2"></a>
Basic Concept</h1>
<p>For details about the SPI Host, see <a href="http://jianingchen.github.io/scamp5c/arm_linux/">http://jianingchen.github.io/scamp5c/arm_linux/</a></p>
<h1><a class="anchor" id="s5c_spi_macro_sec_3"></a>
SPI Upwards Communication</h1>
<h2><a class="anchor" id="s5c_spi_macro_sec_3_1"></a>
Send Standard Packet</h2>
<p>A standard packet is a SPI packet with some format designated to send basic debug information to the host, such as frame readout or events.</p>
<p>The SPI Host can recognize standard packet and treat them differently, including a extra layer of translation. The SPI Host App is able to graphically display the data in standard packets.</p>
<p>For example, a simple camera using SPI: </p><div class="fragment"><div class="line"><span class="preprocessor">#start</span></div>
<div class="line">    </div>
<div class="line">    rpix(B,C)</div>
<div class="line">    </div>
<div class="line">    ipu.inc_loop_counter</div>
<div class="line">    spi.wait_fifo_space(SPI_FIFO_SPACE_768)</div>
<div class="line">    </div>
<div class="line">    spi.begin</div>
<div class="line">    spi.aout64(C)</div>
<div class="line">    spi.end</div>
<div class="line">    </div>
<div class="line"><a class="code" href="a00027.html#a944f12213c10024477282b210c7cb5f6">_jump</a>(<span class="preprocessor">#start)</span></div>
</div><!-- fragment --><h2><a class="anchor" id="s5c_spi_macro_sec_3_2"></a>
Send Packet with Arbitrary Data</h2>
<p>If some data packet with highly customized data format is needed, one can compose a generic data packet by sending a header first (use <a class="el" href="a00031.html#a61a3067f1c9accdfbc2c23f361a0851e" title="send a spi header, which containing the payload size. The size of the header itself is always 8 bytes...">spi_send_header</a>) followed by the payload bytes.</p>
<p>The following code segment uses a generic data packet to send back 6 bytes of user data back to the host: </p><div class="fragment"><div class="line">...</div>
<div class="line"></div>
<div class="line">spi.begin</div>
<div class="line"></div>
<div class="line"><span class="comment">// header (payload size = 6)</span></div>
<div class="line">spi.send_header(6)</div>
<div class="line"></div>
<div class="line"><span class="comment">// payload</span></div>
<div class="line">spi.send_byte(0xAA)</div>
<div class="line">spi.send_byte(0xBB)</div>
<div class="line">spi.send_byte(100)</div>
<div class="line">spi.send_byte(200)</div>
<div class="line">spi.send_byte(s0)</div>
<div class="line">spi.send_byte(s1)</div>
<div class="line"></div>
<div class="line">spi.end</div>
<div class="line"></div>
<div class="line">...</div>
</div><!-- fragment --><p>See also <a class="el" href="a00006.html#sec_example_guide_2_13">Example 13: SPI Communication</a> for a complete example.</p>
<h1><a class="anchor" id="s5c_spi_macro_sec_4"></a>
SPI Downwards Communication</h1>
<p>When a transfer occurs, the first 8 bytes received at MOSI are stored in the SPI input ports. These value can be read using ::spi_port.</p>
<p>Note: since SPI transfers are triggered by upwards communcation, there must be upwards communications inside the frame loop to enable downwards communication. It nothing in particular is needed to be sent from SCAMP-5 to the host, one can simply send the loop counter (use <a class="el" href="a00031.html#afa2821911e40165dfa2fea1b6a710818" title="send the loop counter as a standard packet (packet size: 12 bytes) ">spi_send_loop_counter</a>) just to ensure downwards communication is processed.</p>
<h1><a class="anchor" id="s5c_spi_macro_sec_5"></a>
Configure SPI Host App GUI</h1>
<p>(TODO) </p>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Jun 23 2016 15:01:36 for SCAMP-5c Vision System by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.10
</small></address>
</body>
</html>
